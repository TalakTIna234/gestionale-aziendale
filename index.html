<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Aziendale</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="modern-header">
            <div class="header-container">
                <div class="header-left">
                    <h1>GESTIONALE</h1>
                    <div class="header-subtitle">Sistema Aziendale</div>
                </div>
                
                <div class="header-center">
                    <div class="clock-container">
                        <div class="modern-time" id="modernTime">00:00:00</div>
                        <div class="modern-date" id="modernDate">Caricamento...</div>
                    </div>
                    <div class="weather-badge">
                        <span>ğŸŒ¤ï¸</span>
                        <span>22Â°C</span>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="stats-widget">
                        <div class="stats-label">Oggi</div>
                        <div class="stats-value" id="todayRevenue">â‚¬0</div>
                    </div>
                    
                    <div class="header-actions">
                        <button class="action-btn" onclick="backupData()" title="Backup Dati">
                            ğŸ’¾
                        </button>
                        <button class="action-btn" onclick="toggleNotifications()" title="Notifiche">
                            ğŸ””
                            <div class="notification-dot"></div>
                        </button>
                        <button class="action-btn" onclick="toggleDarkMode()" title="ModalitÃ  Scura">
                            ğŸŒ™
                        </button>
                        <button class="action-btn" onclick="openSettings()" title="Impostazioni">
                            âš™ï¸
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" data-section="dashboard">ğŸ“Š Dashboard</button>
            <button class="nav-btn" data-section="cassa">ğŸ’µ Chiusura Cassa</button>
            <button class="nav-btn" data-section="fatture">ğŸ“‘ Fatture</button>
            <button class="nav-btn" data-section="ricorrenze">ğŸ” Ricorrenze</button>
            <button class="nav-btn" data-section="calendario">ğŸ“… Calendario</button>
        </nav>

        <main>
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="main-section active">
                <h2>ğŸ“Š Dashboard Aziendale Avanzata</h2>
                
                <div class="dashboard-filters">
                    <div class="filter-group">
                        <label>Periodo di Analisi:</label>
                        <select id="dashboardPeriod">
                            <option value="week">ğŸ“… Settimana</option>
                            <option value="month" selected>ğŸ—“ï¸ Mese</option>
                            <option value="quarter">ğŸ“† Trimestre</option>
                            <option value="year">ğŸ—“ï¸ Anno</option>
                            <option value="all">ğŸ“Š Tutto</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Anno:</label>
                        <select id="dashboardYear">
                            <option value="2024">2024</option>
                            <option value="2025" selected>2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    
                    <button id="refreshDashboard">ğŸ”„ Aggiorna</button>
                </div>

                <div class="kpi-grid">
                    <div class="kpi-card revenue">
                        <div class="kpi-icon">ğŸ’°</div>
                        <div class="kpi-content">
                            <h3>Ricavi Totali</h3>
                            <div class="kpi-value" id="totalRevenue">â‚¬0.00</div>
                            <div class="kpi-change">+0%</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card expenses">
                        <div class="kpi-icon">ğŸ“¤</div>
                        <div class="kpi-content">
                            <h3>Spese Totali</h3>
                            <div class="kpi-value" id="totalExpenses">â‚¬0.00</div>
                            <div class="kpi-change">+0%</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card profit">
                        <div class="kpi-icon">ğŸ“ˆ</div>
                        <div class="kpi-content">
                            <h3>Utile Netto</h3>
                            <div class="kpi-value" id="netProfit">â‚¬0.00</div>
                            <div class="kpi-change">+0%</div>
                        </div>
                    </div>
                    
                    <div class="kpi-card vat">
                        <div class="kpi-icon">ğŸ›ï¸</div>
                        <div class="kpi-content">
                            <h3>IVA da Versare</h3>
                            <div class="kpi-value" id="vatToPay">â‚¬0.00</div>
                            <div class="kpi-change">+0%</div>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>ğŸ“Š Andamento Mensile</h3>
                        <canvas id="monthlyTrendChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ¥§ Distribuzione Entrate</h3>
                        <canvas id="revenueDistributionChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ“‰ Analisi Spese</h3>
                        <canvas id="expensesAnalysisChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>ğŸ’¹ Trend IVA</h3>
                        <canvas id="vatTrendChart"></canvas>
                    </div>
                </div>

                <div class="dashboard-sections">
                    <div class="dashboard-section">
                        <h3>ğŸ’° Analisi Entrate</h3>
                        <div class="section-content">
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">Scontrinato Cassa:</span>
                                    <span class="metric-value" id="cashRevenue">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Entrate Ricorrenti:</span>
                                    <span class="metric-value" id="recurringRevenue">â‚¬0.00</span>
                                </div>
                            </div>
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">Media Giornaliera:</span>
                                    <span class="metric-value">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Crescita vs Periodo Prec.:</span>
                                    <span class="metric-value">+0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h3>ğŸ“¤ Analisi Spese</h3>
                        <div class="section-content">
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">Fatture Pagate:</span>
                                    <span class="metric-value" id="paidInvoices">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Fatture in Sospeso:</span>
                                    <span class="metric-value" id="pendingInvoices">â‚¬0.00</span>
                                </div>
                            </div>
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">Spese Ricorrenti:</span>
                                    <span class="metric-value" id="recurringExpenses">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Fatture Scadute:</span>
                                    <span class="metric-value critical" id="overdueInvoices">â‚¬0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h3>ğŸ›ï¸ Situazione Fiscale</h3>
                        <div class="section-content">
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">IVA su Vendite (22%):</span>
                                    <span class="metric-value" id="salesVat">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">IVA su Acquisti:</span>
                                    <span class="metric-value" id="purchaseVat">â‚¬0.00</span>
                                </div>
                            </div>
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">IVA Netta da Versare:</span>
                                    <span class="metric-value" id="netVat">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Prossima Scadenza:</span>
                                    <span class="metric-value">16/07/2025</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h3>ğŸ”® Previsioni e Obiettivi</h3>
                        <div class="section-content">
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">Obiettivo Mensile:</span>
                                    <span class="metric-value" id="monthlyTarget">â‚¬50,000</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Raggiungimento:</span>
                                    <span class="metric-value" id="targetAchievement">0%</span>
                                </div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="targetProgress"></div>
                            </div>
                            <div class="metric-row">
                                <div class="metric">
                                    <span class="metric-label">Previsione Fine Mese:</span>
                                    <span class="metric-value">â‚¬0.00</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Giorni Rimanenti:</span>
                                    <span class="metric-value">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alerts-section">
                    <h3>ğŸš¨ Alert e Notifiche</h3>
                    <div class="alerts-container" id="alertsContainer">
                        <!-- Alert dinamici verranno inseriti qui -->
                    </div>
                </div>
            </section>

            <!-- Chiusura Cassa Section -->
            <section id="cassa-section" class="main-section">
                <h2>ğŸ’µ Chiusura Cassa</h2>
                
                <div class="cassa-calendar-section">
                    <h3>ğŸ“… Calendario Chiusure</h3>
                    <div class="cassa-calendar-controls">
                        <button id="cassaPrevMonth">â—€ Precedente</button>
                        <div id="cassaCalendarMonth">Mese Anno</div>
                        <button id="cassaNextMonth">Successivo â–¶</button>
                    </div>
                    <div class="cassa-calendar-grid" id="cassaCalendarGrid">
                        <!-- Calendario generato dinamicamente -->
                    </div>
                    <div class="selected-date-info" id="selectedDateInfo">
                        Data selezionata: Oggi
                    </div>
                </div>

                <form id="chiusuraForm" class="main-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data">ğŸ“… Data</label>
                            <input type="date" id="data" name="data" required>
                        </div>
                        <div class="form-group">
                            <label for="scontrinatoTotale">ğŸ’° Scontrinato Totale</label>
                            <input type="number" id="scontrinatoTotale" name="scontrinatoTotale" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scontrinatoContanti">ğŸ’µ Scontrinato Contanti</label>
                            <input type="number" id="scontrinatoContanti" name="scontrinatoContanti" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="scontrinatoPOS">ğŸ’³ Scontrinato POS</label>
                            <input type="number" id="scontrinatoPOS" name="scontrinatoPOS" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="art74">ğŸ“„ Art. 74</label>
                            <input type="number" id="art74" name="art74" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="art22">ğŸ“‹ Art. 22</label>
                            <input type="number" id="art22" name="art22" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dropPOS">ğŸ’³ Drop POS</label>
                            <input type="number" id="dropPOS" name="dropPOS" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="dropCash">ğŸ’µ Drop Cash</label>
                            <input type="number" id="dropCash" name="dropCash" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="monetePrecedenti">ğŸª™ Monete Giorno Precedente</label>
                            <input type="number" id="monetePrecedenti" name="monetePrecedenti" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="moneteAttuali">ğŸª™ Monete Attuali</label>
                            <input type="number" id="moneteAttuali" name="moneteAttuali" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div id="verificationResult" class="verification-result"></div>
                    <div id="articoliVerification" class="articoli-verification"></div>
                    
                    <div class="calculation-result">
                        <strong>ğŸ’° Totale Contanti in Cassa: <span id="totaleContanti">â‚¬0.00</span></strong>
                    </div>
                    
                    <div id="fondoCassaResult" class="fondo-cassa-result">
                        <div class="formula">Fondo Cassa = Contanti in Cassa - Scontrinato Contanti - Drop Cash + Differenza Monete - 100</div>
                        <div class="result-value">â‚¬0.00</div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="verificaCompleta" class="btn btn-secondary">ğŸ” Verifica Completa</button>
                        <button type="button" id="salvaChiusura" class="btn btn-primary">ğŸ’¾ Salva Chiusura</button>
                        <button type="button" id="esportaReport" class="btn btn-success">ğŸ“„ Esporta Report</button>
                    </div>
                </form>
                
                <div class="status-indicator">
                    <div class="status-dot ok"></div>
                    <div class="status-text">Sistema pronto</div>
                </div>
            </section>

            <!-- Fatture Section -->
            <section id="fatture-section" class="main-section">
                <h2>ğŸ“‘ Gestione Fatture</h2>
                
                <div class="fornitori-section">
                    <h3>ğŸ‘¥ Gestione Fornitori</h3>
                    <div class="fornitori-controls">
                        <input type="text" id="nuovoFornitore" placeholder="Nome fornitore">
                        <button id="aggiungiFornitore" class="btn btn-primary">â• Aggiungi</button>
                    </div>
                    <div class="fornitori-list" id="fornitoriList">
                        <!-- Fornitori caricati dinamicamente -->
                    </div>
                </div>

                <form id="fatturaForm" class="main-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fatturaFornitore">ğŸ¢ Fornitore</label>
                            <select id="fatturaFornitore" name="fornitore" required>
                                <option value="">Seleziona fornitore...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fatturaImporto">ğŸ’° Importo</label>
                            <input type="number" id="fatturaImporto" name="importo" step="0.01" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fatturaDescrizione">ğŸ“ Descrizione</label>
                            <input type="text" id="fatturaDescrizione" name="descrizione">
                        </div>
                        <div class="form-group">
                            <label for="fatturaDataFattura">ğŸ“… Data Fattura</label>
                            <input type="date" id="fatturaDataFattura" name="dataFattura" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fatturaScadenza">â° Scadenza</label>
                            <input type="date" id="fatturaScadenza" name="scadenza" required>
                        </div>
                        <div class="form-group">
                            <label for="fatturaModalitaPagamento">ğŸ’³ ModalitÃ  Pagamento</label>
                            <select id="fatturaModalitaPagamento" name="modalitaPagamento">
                                <option value="Bonifico">ğŸ’¸ Bonifico</option>
                                <option value="Contanti">ğŸ’µ Contanti</option>
                                <option value="Assegno">ğŸ“ Assegno</option>
                                <option value="Carta di Credito">ğŸ’³ Carta di Credito</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fatturaStato">ğŸ“Š Stato</label>
                            <select id="fatturaStato" name="stato">
                                <option value="da pagare">â³ Da Pagare</option>
                                <option value="pagata">âœ… Pagata</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ Salva Fattura</button>
                        <button type="button" id="resetFatturaForm" class="btn btn-secondary">ğŸ”„ Reset</button>
                    </div>
                </form>

                <div class="fatture-filters">
                    <h3>ğŸ” Filtri e Ricerca</h3>
                    <div class="filter-row">
                        <select id="filtroStato">
                            <option value="">Tutti gli stati</option>
                            <option value="da pagare">Da Pagare</option>
                            <option value="pagata">Pagata</option>
                        </select>
                        <select id="filtroFornitore">
                            <option value="">Tutti i fornitori</option>
                        </select>
                        <input type="text" id="filtroRicerca" placeholder="Cerca per fornitore o descrizione...">
                    </div>
                </div>

                <div class="fatture-grid" id="fattureGrid">
                    <div class="empty-state">ğŸ“‹ Elenco Fatture</div>
                </div>
            </section>

            <!-- Ricorrenze Section -->
            <section id="ricorrenze-section" class="main-section">
                <h2>ğŸ” Gestione Ricorrenze</h2>
                
                <form id="ricorrenzaForm" class="main-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ricorrenzaTipo">ğŸ“Š Tipo</label>
                            <select id="ricorrenzaTipo" name="tipo" required>
                                <option value="entrata">ğŸ’° Entrata</option>
                                <option value="uscita">ğŸ“¤ Uscita</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ricorrenzaNome">ğŸ“ Nome</label>
                            <input type="text" id="ricorrenzaNome" name="nome" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ricorrenzaImporto">ğŸ’° Importo</label>
                            <input type="number" id="ricorrenzaImporto" name="importo" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="ricorrenzaFrequenza">â° Frequenza</label>
                            <select id="ricorrenzaFrequenza" name="frequenza" required>
                                <option value="settimanale">ğŸ“… Settimanale</option>
                                <option value="mensile">ğŸ—“ï¸ Mensile</option>
                                <option value="annuale">ğŸ“† Annuale</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ Salva Ricorrenza</button>
                        <button type="button" id="resetRicorrenzaForm" class="btn btn-secondary">ğŸ”„ Reset</button>
                    </div>
                </form>

                <div class="ricorrenze-list" id="ricorrenzeList">
                    <div class="empty-state">ğŸ“‹ Elenco Ricorrenze</div>
                </div>
            </section>

            <!-- Calendario Section -->
            <section id="calendario-section" class="main-section">
                <div class="calendar-section">
                    <h2>ğŸ“… Calendario Chiusure e Eventi</h2>
                    
                    <div class="calendar-controls">
                        <button id="prevMonth">â—€ Precedente</button>
                        <div id="calendarMonth">Mese Anno</div>
                        <button id="nextMonth">Successivo â–¶</button>
                    </div>
                    
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendario generato dinamicamente -->
                    </div>
                    
                    <div class="calendar-details" id="calendarDetails">
                        <h3>ğŸ“Š Dettagli Chiusura</h3>
                        <p style="text-align: center; color: #6c757d; font-style: italic;">
                            Seleziona una data per visualizzare i dettagli
                        </p>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="window.print()">ğŸ–¨ï¸ Stampa</button>
                            <button onclick="exportData()">ğŸ“¥ Esporta</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal per messaggi -->
    <div id="chiusuraModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-body">
                <!-- Contenuto dinamico -->
            </div>
        </div>
    </div>

    <!-- Chart.js per i grafici -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    // Configurazione Supabase globale
    const { createClient } = supabase;
    const supabaseUrl = 'https://fodowfardgribthpgxxs.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZvZG93ZmFyZGdyaWJ0aHBneHhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1OTkyNzIsImV4cCI6MjA2NjE3NTI3Mn0.KXvV_Lzve4sUNzM79Zp31kuzos4jGTIRqGV0UGewLfk';
    const supabase = createClient(supabaseUrl, supabaseKey);
    </script>

    <!-- Il tuo script principale -->
    <script src="script.js"></script>
</body>
</html>
