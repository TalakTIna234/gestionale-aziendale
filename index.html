<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Pro - Sistema Aziendale Avanzato</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>
<body>
    <div class="container">
        <header class="modern-header">
            <div class="header-container">
                <div class="header-left">
                    <h1>üè™ Gestionale Pro</h1>
                    <div class="header-subtitle">Sistema Aziendale Avanzato</div>
                </div>
                <div class="header-center">
                    <div class="clock-container">
                        <div id="modernTime" class="modern-time"></div>
                        <div id="modernDate" class="modern-date"></div>
                    </div>
                    <div class="weather-badge">
                        <span>‚òÄÔ∏è</span>
                        <span>22¬∞C Palermo</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="stats-widget">
                        <div class="stats-label">Oggi</div>
                        <div class="stats-value" id="todayRevenue">‚Ç¨0</div>
                    </div>
                    <div class="header-actions">
                        <button class="action-btn" title="Backup" onclick="backupData()">üíæ</button>
                        <button class="action-btn" title="Notifiche" onclick="toggleNotifications()">üîî<span class="notification-dot"></span></button>
                        <button class="action-btn" title="Modalit√† Scura" onclick="toggleDarkMode()">üåô</button>
                        <button class="action-btn" title="Impostazioni" onclick="openSettings()">‚öôÔ∏è</button>
                    </div>
                </div>
            </div>
        </header>

        <nav class="main-nav">
            <button class="nav-btn active" data-section="dashboard">Dashboard</button>
            <button class="nav-btn" data-section="cassa">Chiusura Cassa</button>
            <button class="nav-btn" data-section="fatture">Fatture</button>
            <button class="nav-btn" data-section="ricorrenze">Ricorrenze</button>
            <button class="nav-btn" data-section="calendario">Calendario</button>
        </nav>

        <section id="dashboard-section" class="main-section active">
            <h2>üìä Dashboard Aziendale Avanzata</h2>
            <div class="dashboard-filters">
                <div class="filter-group">
                    <label>Periodo di Analisi:</label>
                    <select id="dashboardPeriod">
                        <option value="week">Settimana</option>
                        <option value="month" selected>Mese</option>
                        <option value="quarter">Trimestre</option>
                        <option value="year">Anno</option>
                        <option value="all">Tutto</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Anno:</label>
                    <select id="dashboardYear">
                        <option value="2024">2024</option>
                        <option value="2025" selected>2025</option>
                        <option value="2026">2026</option>
                    </select>
                </div>
                <button id="refreshDashboard" class="btn btn-primary">üîÑ Aggiorna</button>
            </div>
            <div class="kpi-grid">
                <div class="kpi-card revenue">
                    <div class="kpi-icon">üí∞</div>
                    <div class="kpi-content">
                        <h3>Ricavi Totali</h3>
                        <div class="kpi-value" id="totalRevenue">‚Ç¨0.00</div>
                        <div class="kpi-change" id="revenueChange">+0%</div>
                    </div>
                </div>
                <div class="kpi-card expenses">
                    <div class="kpi-icon">üì§</div>
                    <div class="kpi-content">
                        <h3>Spese Totali</h3>
                        <div class="kpi-value" id="totalExpenses">‚Ç¨0.00</div>
                        <div class="kpi-change" id="expensesChange">+0%</div>
                    </div>
                </div>
                <div class="kpi-card profit">
                    <div class="kpi-icon">üìà</div>
                    <div class="kpi-content">
                        <h3>Utile Netto</h3>
                        <div class="kpi-value" id="netProfit">‚Ç¨0.00</div>
                        <div class="kpi-change" id="profitChange">+0%</div>
                    </div>
                </div>
                <div class="kpi-card vat">
                    <div class="kpi-icon">üèõÔ∏è</div>
                    <div class="kpi-content">
                        <h3>IVA da Versare</h3>
                        <div class="kpi-value" id="vatToPay">‚Ç¨0.00</div>
                        <div class="kpi-change" id="vatChange">+0%</div>
                    </div>
                </div>
            </div>
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>üìä Andamento Mensile</h3>
                    <canvas id="monthlyTrendChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ü•ß Distribuzione Entrate</h3>
                    <canvas id="revenueDistributionChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üìâ Analisi Spese</h3>
                    <canvas id="expensesAnalysisChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üíπ Trend IVA</h3>
                    <canvas id="vatTrendChart"></canvas>
                </div>
            </div>
            <div class="dashboard-sections">
                <div class="dashboard-section">
                    <h3>üí∞ Analisi Entrate</h3>
                    <div class="section-content">
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">Scontrinato Cassa:</span>
                                <span class="metric-value" id="cashRevenue">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Entrate Ricorrenti:</span>
                                <span class="metric-value" id="recurringRevenue">‚Ç¨0.00</span>
                            </div>
                        </div>
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">Media Giornaliera:</span>
                                <span class="metric-value" id="dailyAverage">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Crescita vs Periodo Prec.:</span>
                                <span class="metric-value" id="revenueGrowth">+0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>üì§ Analisi Spese</h3>
                    <div class="section-content">
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">Fatture Pagate:</span>
                                <span class="metric-value" id="paidInvoices">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Fatture in Sospeso:</span>
                                <span class="metric-value" id="pendingInvoices">‚Ç¨0.00</span>
                            </div>
                        </div>
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">Spese Ricorrenti:</span>
                                <span class="metric-value" id="recurringExpenses">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Fatture Scadute:</span>
                                <span class="metric-value critical" id="overdueInvoices">‚Ç¨0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>üèõÔ∏è Situazione Fiscale</h3>
                    <div class="section-content">
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">IVA su Vendite (22%):</span>
                                <span class="metric-value" id="salesVat">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">IVA su Acquisti:</span>
                                <span class="metric-value" id="purchaseVat">‚Ç¨0.00</span>
                            </div>
                        </div>
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">IVA Netta da Versare:</span>
                                <span class="metric-value" id="netVat">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Prossima Scadenza:</span>
                                <span class="metric-value" id="nextVatDeadline">16/07/2025</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>üîÆ Previsioni e Obiettivi</h3>
                    <div class="section-content">
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">Obiettivo Mensile:</span>
                                <span class="metric-value" id="monthlyTarget">‚Ç¨50,000</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Raggiungimento:</span>
                                <span class="metric-value" id="targetAchievement">0%</span>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="targetProgress"></div>
                        </div>
                        <div class="metric-row">
                            <div class="metric">
                                <span class="metric-label">Previsione Fine Mese:</span>
                                <span class="metric-value" id="monthEndForecast">‚Ç¨0.00</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Giorni Rimanenti:</span>
                                <span class="metric-value" id="daysRemaining">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="alerts-section">
                <h3>üö® Alert e Notifiche</h3>
                <div id="alertsContainer" class="alerts-container"></div>
            </div>
        </section>

        <section id="cassa-section" class="main-section">
            <h2>üíµ Chiusura Cassa</h2>
            <div class="cassa-calendar-section">
                <h3>Calendario Chiusure</h3>
                <div class="cassa-calendar-controls">
                    <button id="cassaPrevMonth">&lt;</button>
                    <span id="cassaCalendarMonth"></span>
                    <button id="cassaNextMonth">&gt;</button>
                </div>
                <div id="cassaCalendarGrid" class="cassa-calendar-grid"></div>
                <div id="selectedDateDisplay" class="selected-date-info"></div>
            </div>
            <form id="chiusuraCassaForm" class="main-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="scontrinatoTotale">Scontrinato Totale</label>
                        <input type="number" step="0.01" id="scontrinatoTotale" required>
                    </div>
                    <div class="form-group">
                        <label for="scontrinatoContanti">Scontrinato Contanti</label>
                        <input type="number" step="0.01" id="scontrinatoContanti" required>
                    </div>
                    <div class="form-group">
                        <label for="scontrinatoPos">Scontrinato POS</label>
                        <input type="number" step="0.01" id="scontrinatoPos" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="art74">Art. 74</label>
                        <input type="number" step="0.01" id="art74">
                    </div>
                    <div class="form-group">
                        <label for="art22">Art. 22</label>
                        <input type="number" step="0.01" id="art22">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dropPos">Drop POS</label>
                        <input type="number" step="0.01" id="dropPos">
                    </div>
                    <div class="form-group">
                        <label for="dropCash">Drop Cash</label>
                        <input type="number" step="0.01" id="dropCash">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="moneteGiornoPrecedente">Monete Giorno Precedente</label>
                        <input type="number" step="0.01" id="moneteGiornoPrecedente">
                    </div>
                    <div class="form-group">
                        <label for="moneteAttuali">Monete Attuali</label>
                        <input type="number" step="0.01" id="moneteAttuali">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="totaleContantiCassa">Totale Contanti in Cassa</label>
                        <input type="number" step="0.01" id="totaleContantiCassa">
                    </div>
                </div>
                <div id="verificationResult" class="verification-result"></div>
                <div id="articoliVerification" class="articoli-verification"></div>
                <div id="differenzaMonete" class="calculation-result"></div>
                <div class="fondo-cassa-result">
                    <div class="formula">Fondo Cassa = Contanti in Cassa - Scontrinato Contanti - Drop Cash + Differenza Monete - 100</div>
                    <div id="fondoCassaResult" class="result-value">‚Ç¨0.00</div>
                    <div id="fondoCassaInterpretation" class="result-interpretation"></div>
                </div>
                <div class="form-actions">
                    <button type="button" id="verificaCompleta" class="btn btn-primary">üîç Verifica Completa</button>
                    <button type="submit" id="salvaBtn" class="btn btn-success">üíæ Salva Chiusura</button>
                    <button type="button" id="esportaBtn" class="btn btn-secondary">üìÑ Esporta Report</button>
                </div>
            </form>
        </section>

        <section id="fatture-section" class="main-section">
            <h2>üìë Gestione Fatture</h2>
            <div class="fornitori-section">
                <h3>üë• Gestione Fornitori</h3>
                <div class="fornitori-controls">
                    <input type="text" id="nuovoFornitore" placeholder="Aggiungi nuovo fornitore">
                    <button id="aggiungiFornitore" class="btn btn-success">‚ûï Aggiungi</button>
                </div>
                <div id="fornitoriList" class="fornitori-list"></div>
            </div>
            <form id="fatturaForm" class="fattura-form">
                <input type="hidden" id="fatturaId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="fornitore">Fornitore</label>
                        <select id="fornitore" required>
                            <option value="">Seleziona fornitore...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="importoFattura">Importo</label>
                        <input type="number" step="0.01" id="importoFattura" required>
                    </div>
                    <div class="form-group">
                        <label for="descrizioneFattura">Descrizione</label>
                        <input type="text" id="descrizioneFattura" placeholder="Descrizione fattura">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataFattura">Data Fattura</label>
                        <input type="date" id="dataFattura" required>
                    </div>
                    <div class="form-group">
                        <label for="scadenzaFattura">Scadenza</label>
                        <input type="date" id="scadenzaFattura" required>
                    </div>
                    <div class="form-group">
                        <label for="modalitaPagamento">Modalit√† Pagamento</label>
                        <select id="modalitaPagamento">
                            <option value="bonifico">Bonifico</option>
                            <option value="contanti">Contanti</option>
                            <option value="assegno">Assegno</option>
                            <option value="carta">Carta di Credito</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="statoFattura">Stato</label>
                        <select id="statoFattura">
                            <option value="da pagare">Da Pagare</option>
                            <option value="pagata">Pagata</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">üíæ Salva Fattura</button>
                    <button type="button" id="resetFatturaForm" class="btn btn-secondary">üîÑ Reset</button>
                </div>
            </form>
            <div class="fatture-filters">
                <h3>üîç Filtri e Ricerca</h3>
                <div class="filter-row">
                    <select id="filtroStato">
                        <option value="">Tutti gli stati</option>
                        <option value="da pagare">Da Pagare</option>
                        <option value="pagata">Pagata</option>
                    </select>
                    <select id="filtroFornitore">
                        <option value="">Tutti i fornitori</option>
                    </select>
                    <input type="text" id="filtroRicerca" placeholder="üîç Cerca fattura...">
                </div>
            </div>
            <div class="fatture-container">
                <h3>üìã Elenco Fatture</h3>
                <div id="fattureList" class="fatture-grid"></div>
            </div>
        </section>

        <section id="ricorrenze-section" class="main-section">
            <h2>üîÅ Gestione Ricorrenze</h2>
            <form id="ricorrenzaForm" class="ricorrenza-form">
                <input type="hidden" id="ricorrenzaId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="tipoRicorrenza">Tipo</label>
                        <select id="tipoRicorrenza" required>
                            <option value="entrata">üí∞ Entrata</option>
                            <option value="uscita">üì§ Uscita</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="nomeRicorrenza">Nome</label>
                        <input type="text" id="nomeRicorrenza" placeholder="Nome della ricorrenza" required>
                    </div>
                    <div class="form-group">
                        <label for="importoRicorrenza">Importo</label>
                        <input type="number" step="0.01" id="importoRicorrenza" required>
                    </div>
                    <div class="form-group">
                        <label for="frequenzaRicorrenza">Frequenza</label>
                        <select id="frequenzaRicorrenza" required>
                            <option value="settimanale">üìÖ Settimanale</option>
                            <option value="mensile">üóìÔ∏è Mensile</option>
                            <option value="annuale">üìÜ Annuale</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">üíæ Salva Ricorrenza</button>
                    <button type="button" id="resetRicorrenzaForm" class="btn btn-secondary">üîÑ Reset</button>
                </div>
            </form>
            <div class="ricorrenze-container">
                <h3>üìã Elenco Ricorrenze</h3>
                <div id="ricorrenzeList"></div>
            </div>
        </section>

        <section id="calendario-section" class="main-section">
            <div class="calendar-section">
                <h2>üìÖ Calendario Chiusure e Eventi</h2>
                <div class="calendar-controls">
                    <button id="prevMonth">‚óÄ Precedente</button>
                    <span id="calendarMonth"></span>
                    <button id="nextMonth">Successivo ‚ñ∂</button>
                    <button id="printClosure" title="Stampa">üñ®Ô∏è Stampa</button>
                    <button id="exportClosure" title="Esporta">üì• Esporta</button>
                </div>
                <div id="calendarGrid" class="calendar-grid"></div>
                <div id="calendarDetails" class="calendar-details" style="display:none;">
                    <h3>üìä Dettagli Chiusura</h3>
                    <pre id="calendarDetailsContent"></pre>
                    <div class="calendar-actions">
                        <button onclick="window.print()">üñ®Ô∏è Stampa</button>
                        <button onclick="window.calendarChiusure.exportClosure()">üì• Esporta</button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script src="script.js"></script>

</body>
</html>
